<div class="form-page-container">
  <header class="form-header">
    <h1>{{ pageTitle }}</h1>
    <button type="button" (click)="cancel()" class="btn btn-link-secondary" [disabled]="isLoading">
      <i class="fas fa-arrow-left"></i> Voltar para o Planejador
    </button>
  </header>

  <div class="form-content">
    <div *ngIf="isLoading" class="loading-indicator">
      <i class="fas fa-spinner fa-spin"></i>
      {{ isEditMode ? 'Carregando dados do agendamento...' : 'Carregando pré-requisitos...'}}
    </div>

    <form [formGroup]="itineraryForm" (ngSubmit)="onSubmit()" *ngIf="!isLoading" class="data-form">
      <div class="form-section">
        <h3 class="section-title">Detalhes do Agendamento</h3>
        <div class="form-row">
          <div class="form-field">
            <label for="routeId">Rota <span class="required-asterisk">*</span></label>
            <select id="routeId" formControlName="routeId"
                    [class.invalid-field]="itineraryForm.get('routeId')?.invalid && itineraryForm.get('routeId')?.touched">
              <option [ngValue]="null" disabled>-- Selecione uma Rota --</option>
              <option *ngFor="let route of availableRoutes" [ngValue]="route.id">
                {{ route.name }}
              </option>
            </select>
            <div *ngIf="itineraryForm.get('routeId')?.invalid && itineraryForm.get('routeId')?.touched" class="error-message">
              A seleção da rota é obrigatória.
            </div>
          </div>

          <div class="form-field">
            <label for="truckId">Caminhão <span class="required-asterisk">*</span></label>
            <select id="truckId" formControlName="truckId"
                    [class.invalid-field]="itineraryForm.get('truckId')?.invalid && itineraryForm.get('truckId')?.touched">
              <option [ngValue]="null" disabled>-- Selecione um Caminhão --</option>
              <option *ngFor="let truck of availableTrucks" [ngValue]="truck.id">
                {{ truck.licensePlate }} ({{ truck.driverName }})
              </option>
            </select>
            <div *ngIf="itineraryForm.get('truckId')?.invalid && itineraryForm.get('truckId')?.touched" class="error-message">
              A seleção do caminhão é obrigatória.
            </div>
          </div>

          <div class="form-field">
            <label for="collectionDate">Data da Coleta <span class="required-asterisk">*</span></label>
            <input type="date" id="collectionDate" formControlName="collectionDate"
                   [class.invalid-field]="itineraryForm.get('collectionDate')?.invalid && itineraryForm.get('collectionDate')?.touched">
            <div *ngIf="itineraryForm.get('collectionDate')?.invalid && itineraryForm.get('collectionDate')?.touched" class="error-message">
              A data da coleta é obrigatória.
            </div>
          </div>
        </div>
      </div>

      <div class="form-actions">
        <button type="submit" [disabled]="itineraryForm.invalid || isLoading" class="btn btn-primary">
          <i class="fas" [ngClass]="isLoading ? 'fa-spinner fa-spin' : (isEditMode ? 'fa-save' : 'fa-calendar-check')"></i>
          {{ isLoading ? 'Salvando...' : (isEditMode ? 'Atualizar Agendamento' : 'Criar Agendamento') }}
        </button>
        <button type="button" (click)="cancel()" class="btn btn-secondary" [disabled]="isLoading">
          <i class="fas fa-times-circle"></i> Cancelar
        </button>
      </div>
    </form>
  </div>
</div>